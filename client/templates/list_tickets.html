{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block title %}
Listing All Tickets
{% endblock %}

{% block content %}
<h1>Listing Tickets in System</h1>
<script type="text/javascript" class="init">
        $(document).ready(function() {
            $('#myTable').DataTable();
        });
</script>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>{{ list_title|default:"Tickets" }}</h2>
    
    <div class="btn-group" role="group" aria-label="Ticket Filter">
        <a href="{% url 'list_tickets' %}" 
           class="btn btn-outline-primary {% if request.resolver_match.url_name == 'list_tickets' %}active{% endif %}">
            All Tickets
        </a>
        <a href="{% url 'my_tickets_list' %}" 
           class="btn btn-outline-primary {% if request.resolver_match.url_name == 'my_tickets_list' %}active{% endif %}">
            My Tickets
        </a>
    </div>
</div>

<table id="myTable" class="display">  
    <thead>
    <tr>
        <th>Slug</th>
        <th>Created</th>
        <th>Status</th>
        <th>Related to Action</th>
        <th>Action</th>
    </tr>
    </thead>
{% for ticket in tickets %}
<tr>
    <td>{{ticket.ticket_slug}}</td>
    <td>{{ticket.ticket_create_date}}</td>
    <td>{{ticket.ticket_status}}</td>
     <td><a href="/client/action_detail/{{ticket.action.id}}">{{ticket.action}}</a></td>
    <td>
    <div class="d-flex align-items-center">
    <a href="{% url 'ticket_detail' ticket.id %}" class="btn btn-sm btn-primary me-2">
        View
    </a>
    
    {% if ticket.ticket_open %}
        <a href="{% url 'update_ticket' ticket.id %}" class="btn btn-sm btn-outline-success">
            + Update
        </a>
    {% else %}
        <span class="badge bg-secondary text-white">Closed</span>
    {% endif %}
</div></td>
</tr>
{% endfor %}
</table>

{% endblock %}


<!-- class Ticket(models.Model):
    ticket_slug=models.CharField(max_length=30, verbose_name="Ticket Short Name")
    ticket_create_date=models.DateField(default=timezone.now)
    ticket_created_by = models.ForeignKey(
        settings.AUTH_USER_MODEL,  # Use settings.AUTH_USER_MODEL for consistency
        on_delete=models.CASCADE,
        related_name='tickets_created_by_user',
        verbose_name="Ticket created by"
    )
    ticket_issue=models.TextField(verbose_name="Issue Description")
    ticket_status=models.CharField(choices=TicketStatusTypes.choices, max_length=30, default='ACTIVE', verbose_name="Ticket Status")
    ticket_resolved_date=models.DateField(null=True, blank=True, verbose_name="Resolved Date")
    ticket_open=models.BooleanField(default=True)
    action=models.ForeignKey(Actions, on_delete=models.CASCADE, related_name='ticket_for_action')

    def __str__(self):
        return self.ticket_slug
     -->